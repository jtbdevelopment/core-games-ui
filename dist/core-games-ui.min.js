!function(e){e.module("coreGamesUi.config",[]).value("coreGamesUi.config",{debug:!0}),e.module("coreGamesUi.directives",[]),e.module("coreGamesUi.filters",[]),e.module("coreGamesUi.services",[]),e.module("coreGamesUi",["coreGamesUi.config","coreGamesUi.directives","coreGamesUi.filters","coreGamesUi.services","ngResource","ngCookies","ngSanitize"])}(angular),angular.module("coreGamesUi.filters").filter("propsFilter",function(){return function(e,n){var r=[];return angular.isArray(e)?e.forEach(function(e){for(var o=!1,t=Object.keys(n),a=0;a<t.length;a++){var s=t[a],i=n[s].toLowerCase();if(-1!==e[s].toString().toLowerCase().indexOf(i)){o=!0;break}}o&&r.push(e)}):r=e,r}}),angular.module("coreGamesUi.services").factory("jtbFacebook",["$http","$location","$q",function(e,n,r){function o(){var o=r.defer();return t?(o.resolve(),o.promise):(e.get("/api/social/apis",{cache:!0}).success(function(e){a=e.facebookAppId,s=e.facebookPermissions,window.fbAsyncInit=function(){FB.init({appId:a,xfbml:!0,version:"v2.1"}),o.resolve(s)},function(e,n,r){function a(){t=!1,o.reject()}var s,i=e.getElementsByTagName(n)[0];e.getElementById(r)||(s=e.createElement(n),s.id=r,s.src="//connect.facebook.net/en_US/sdk.js",s.onerror=a,i.parentNode.insertBefore(s,i))}(document,"script","facebook-jssdk"),t=!0}).error(function(){n.path("/error"),o.reject()}),o.promise)}var t=!1,a="",s="";return{canAutoSignIn:function(){var e=r.defer();return o().then(function(n){FB.getLoginStatus(function(r){e.resolve({auto:angular.isDefined(r)&&angular.isDefined(r.status)&&"connected"===r.status,permissions:n})})},function(){e.reject()}),e.promise},inviteFriends:function(e){o().then(function(){var n=!0,r="";angular.forEach(e,function(e){n?n=!1:r+=", ",r+=e}),FB.ui({method:"apprequests",message:"Come play Twisted Hangman with me!",to:r},function(e){console.info(JSON.stringify(e))})},function(){})},playerAndFBMatch:function(e){var n=r.defer();return o().then(function(){"facebook"===e.source?FB.getLoginStatus(function(r){"connected"===r.status?n.resolve(r.authResponse.userID===e.sourceId):n.resolve(!1)}):n.resolve(!1)}),n.promise}}}]),angular.module("coreGamesUi.services").factory("jtbLiveGameFeed",["$rootScope","jtbPlayerService",function(e,n){function r(){t.url="/livefeed/"+n.currentID(),o=a.subscribe(t)}var o,t={url:"",contentType:"application/json",logLevel:"debug",transport:"long-polling",trackMessageLength:!0,fallbackTransport:"long-polling",onOpen:function(n){console.info(this.url+" Atmosphere connected using "+n.transport),e.$broadcast("liveFeedEstablished")},onMessage:function(n){angular.isDefined(n.messages)?n.messages.forEach(function(n){var r;try{r=JSON.parse(n)}catch(o){return console.error("got non-parseable message"),void 0}if(angular.isDefined(r.messageType)){switch(r.messageType.toString()){case"Game":return e.$broadcast("gameUpdate",r.game.id,r.game),void 0;case"Heartbeat":return console.info("got a heartbeat "+JSON.stringify(r.message)),void 0;case"Player":return e.$broadcast("playerUpdate",r.player.id,r.player),void 0;default:console.warn("onMessage: unknown message type '"+r.messageType+"'")}console.warn("onMessage: unknown message type '"+r.messageType+"'")}console.warn("unknown message structure "+r)}):console.warn(this.url+" unknown onMessage: "+JSON.stringify(n))},onClose:function(e){console.warn(this.url+" closed: "+JSON.stringify(e))},onError:function(e){console.error(this.url+" onError: "+JSON.stringify(e))}},a=$.atmosphere;return e.$on("playerLoaded",function(){angular.isDefined(o)&&o.close(),o=void 0,r()}),{handler:function(){return t}}}]),angular.module("coreGamesUi.services").factory("jtbPlayerService",["$http","$rootScope","$location","$window","jtbFacebook",function(e,n,r,o,t){function a(){n.$broadcast("playerLoaded")}function s(){e.get("/api/security",{cache:!0}).success(function(e){switch(i=e,c=i.id,u=i.id,i.source){case"facebook":t.playerAndFBMatch(i).then(function(e){e?a():d.signOutAndRedirect()},function(){d.signOutAndRedirect()});break;default:a()}}).error(function(){r.path("/error")})}var i,c="",u="",l="/api/player",f="/friends",d={overridePID:function(n){e.put(this.currentPlayerBaseURL()+"/admin/"+n).success(function(e){u=e.id,i=e,a()}).error(function(){r.path("/error")})},realPID:function(){return c},currentID:function(){return u},currentPlayerBaseURL:function(){return l},currentPlayerFriends:function(){return e.get(this.currentPlayerBaseURL()+f).then(function(e){return e.data})},currentPlayer:function(){return i},signOutAndRedirect:function(){e.post("/signout").success(function(){o.location="/signin"}).error(function(){o.location="/signin"})}};return n.$on("playerUpdate",function(e,r,o){console.log("playerUpdate"),u===r&&(angular.copy(o,i),n.$apply())}),s(),d}]);